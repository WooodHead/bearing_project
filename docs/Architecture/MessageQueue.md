# 消息队列（Message Queue）

## 消息策略

更新数据时，删除缓存而不是更新缓存：

1、避免写多读少场景下产生大量冷数据  
2、有些场景缓存可能需要多表数据组合  
3、后续当读取缓存为空也仅须读一次库


## 顺序策略

1、先更新数据库状态，再发送消息  
2、

新建资源 - 生产任务（数据库与任务队列的顺序策略）

序号 | 数据处理 | 消息处理
:---: | --- | ---
1 | 创建记录，设置状态：准备中 | -
2 | - | 发送消息
3 | 更新状态：创建中 | 发送成功
4 | 更新状态：已失败 | 发送失败


新建资源 - 消费任务（数据库与任务队列的顺序策略）

序号 | 数据处理 | 消息处理
:---: | --- | ---
1 | - | 订阅消息
2 | - | 获取
2 | - | 消费
2 | - | 确认（成功/失败）
2 | 更新状态：已完成 | -

消费待确认过程中，异常断电，消息如何处理的，重新启动之后，是否自动重新入队？


新建资源 - 任务结果（数据库与结果队列的顺序策略）

序号 | 数据处理 | 消息处理
:---: | --- | ---
1 | - | 获取消息
2 | - | 发送消息
3 | 更新状态：创建中 | 发送成功
4 | 更新状态：已失败 | 发送失败


## 消息幂等

## 并发场景支持消息幂等
